<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dental Clinic Appointments</title>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .tabs { margin-top: 20px; }
    .tab { display: none; }
    .tab.active { display: block; }
    button { margin-top: 10px; padding: 8px 15px; }
  </style>
</head>
<body>
  <h2>Dental Clinic Appointments</h2>

  <!-- General Info Section -->
  <div id="general-info">
    <h3>Patient Info</h3>
    <label>Name: <input type="text" id="name" required></label><br>
    <label>Email: <input type="email" id="email" required></label><br>
    <label>Phone: <input type="text" id="phone" required></label><br>
    <label>Service: 
      <select id="service">
        <option>Cleaning</option>
        <option>Extraction</option>
        <option>Whitening</option>
        <option>Filling</option>
      </select>
    </label><br>
    <label>Preferred Date: <input type="date" id="date" required></label>
  </div>

  <!-- Tab Buttons -->
  <div class="tabs">
    <button onclick="openTab('book')">Book Appointment</button>
    <button onclick="openTab('reschedule')">Reschedule</button>
    <button onclick="openTab('before')">Before Treatment</button>
  </div>

  <!-- Book Appointment -->
  <div id="book" class="tab">
    <h3>Book Appointment</h3>
    <label>Notes: <textarea id="book_notes"></textarea></label><br>
    <button onclick="bookAppointment()">Submit Booking</button>
  </div>

  <!-- Reschedule -->
  <div id="reschedule" class="tab">
    <h3>Reschedule Appointment</h3>
    <label>Old Appointment Date: <input type="date" id="old_date" required></label><br>
    <label>Reason: <textarea id="reschedule_reason"></textarea></label><br>
    <button onclick="rescheduleAppointment()">Submit Reschedule</button>
  </div>

  <!-- Before Treatment -->
  <div id="before" class="tab">
    <h3>Before Treatment</h3>
    <label>Planned Treatment: <input type="text" id="planned_treatment"></label><br>
    <label>Medical Notes: <textarea id="medical_notes"></textarea></label><br>
    <button onclick="beforeTreatment()">Submit Info</button>
  </div>

  <script>
    // Supabase client
    const { createClient } = supabase;
    const supabaseUrl = "YOUR_SUPABASE_URL";
    const supabaseKey = "YOUR_SUPABASE_ANON_KEY";
    const db = createClient(supabaseUrl, supabaseKey);

    // Tab logic
    function openTab(tabId) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
    }

    // Helper: get general info
    function getGeneralInfo() {
      return {
        name: document.getElementById("name").value,
        email: document.getElementById("email").value,
        phone: document.getElementById("phone").value,
        service: document.getElementById("service").value,
        date: document.getElementById("date").value
      };
    }

    // Book Appointment (INSERT)
    async function bookAppointment() {
      const info = getGeneralInfo();
      const notes = document.getElementById("book_notes").value;

      const { error } = await db.from("appointments").insert([{
        name: info.name,
        email: info.email,
        phone: info.phone,
        service: info.service,
        date: info.date,
        notes: notes
      }]);

      if (error) alert("Error booking: " + error.message);
      else alert("Appointment booked successfully!");
    }

    // Reschedule (UPDATE)
    async function rescheduleAppointment() {
      const info = getGeneralInfo();
      const oldDate = document.getElementById("old_date").value;
      const reason = document.getElementById("reschedule_reason").value;

      const { error } = await db.from("appointments")
        .update({ date: info.date, reason: reason })
        .match({ name: info.name, phone: info.phone, date: oldDate });

      if (error) alert("Error rescheduling: " + error.message);
      else alert("Appointment rescheduled successfully!");
    }

    // Before Treatment (UPDATE)
    async function beforeTreatment() {
      const info = getGeneralInfo();
      const treatment = document.getElementById("planned_treatment").value;
      const notes = document.getElementById("medical_notes").value;

      const { error } = await db.from("appointments")
        .update({ planned_treatment: treatment, medical_notes: notes })
        .match({ name: info.name, phone: info.phone, date: info.date });

      if (error) alert("Error updating treatment: " + error.message);
      else alert("Treatment info saved successfully!");
    }
  </script>
</body>
</html>
